
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Architectural best practices for maintainable, reusable UIs in Angular - Kevin Crawford, Software Engineer</title>
  <meta name="author" content="Kevin Crawford">

  
  <meta name="description" content="After spending substantial time working in-depth in Angular land, and with further influence from incursions into Flux &amp; React, I&#39;ve come to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kvcrawford.github.io/blog/2015/05/30/architectural-best-practices-for-dry">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kevin Crawford, Software Engineer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44222285-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Kevin Crawford, Software Engineer</a></h1>
  
    <h2>Front-End Specialist &middot;  Full-Stack Generalist</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kvcrawford.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/resume">R&eacute;sum&eacute;</a></li>
  <li><a href="/contact">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Architectural Best Practices for Maintainable, Reusable UIs in Angular</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-30T17:15:00-07:00" pubdate data-updated="true">May 30<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>After spending substantial time working in-depth in Angular land, and with further influence from incursions into Flux &amp; React, I&#39;ve come to develop certain opinions on how to best architect non-trivial, data-driven UI flows in an Angular app.</p>

<p>What follows is a case study of a real-world UI problem, solved with the guidance of well-established principles and patterns in software design.</p>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder">Read the code on Github</a> &bull; <a href="http://kvcrawford.github.io/ng-permutation-builder/">See the live demo</a></p>

<!-- more -->

<h2 id="the-user-story">The User Story</h2>

<p>Jill is a marketing campaign manager who spends a lot of time creating slightly different variations of ad creative for her clients. Sometimes, she might want to A/B test different body copy. Other times, she might want to localize the header for different locales.</p>

<p>Rather than waste time creating the otherwise-same creative several times over, she would like to be able to quickly generate the 4 different permutations, and be done with it.</p>

<h2 id="some-guiding-principles">Some Guiding Principles</h2>

<p>Before we begin, I&#39;d like to highlight some design patterns and principles that will guide our implementation. While the purpose of this article is to <em>demonstrate</em> rather than explain these topics in detail, I&#39;ve included links in the footnotes for further reading.</p>

<ul>
<li>The Single Responsibility Principle (SRP) <sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup><sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup><sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup></li>
<li>Separation of Concerns (SoC) <sup id="fnref4"><a href="#fn4" rel="footnote">4</a></sup></li>
<li>Don&#39;t Repeat Yourself (DRY) <sup id="fnref5"><a href="#fn5" rel="footnote">5</a></sup></li>
<li>Curly&#39;s Law: Do One Thing <sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup></li>
</ul>

<p>The strategy described by Facebook&#39;s <a href="https://facebook.github.io/flux/docs/overview.html#content">Flux</a> is one that I find particularly exciting. There are two big concepts: (1) thinking of your UI in terms of a tree of components, and (2) their idea of a <em>store</em>:</p>

<blockquote>
<p>Stores contain the application state and logic. Their role is somewhat similar to a model in a traditional MVC, but they manage the state of many objects â€” they do not represent a single record of data like ORM models do. Nor are they the same as Backbone&#39;s collections. More than simply managing a collection of ORM-style objects, stores manage the application state for a particular domain within the application.</p>
</blockquote>

<p>In an Angular app, we can do something similar with a service, isolating the business logic for a particular UI flow. This offers a number of advantages:</p>

<ul>
<li>The service is easily testable,</li>
<li>It becomes easier to reuse and extend, and</li>
<li>Our controller becomes a very thin layer: it simply glues the various pieces together and binds what&#39;s needed to the view.</li>
</ul>

<h2 id="a-first-iteration">A First Iteration</h2>

<p>One of the most common pitfalls seen in Angular apps are bloated controllers. It can be tempting to wedge bits of logic here and there, as it&#39;s easy at the time. Unfortunately, the controller quickly turns into a tangled mess. Consider the following implementation of our permutation builder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># Placeholder object to hold references for our ngForm instances</span>
</span><span class='line'><span class="nv">$scope.forms = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># This defines the method and immediately invokes it.</span>
</span><span class='line'><span class="c1"># That way we can reset state if the user hits the reset button.</span>
</span><span class='line'><span class="nx">do</span> <span class="nv">$scope.initialize = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">$scope.permutations = </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.permutable_attributes =</span>
</span><span class='line'>    <span class="nv">name: </span><span class="p">[]</span>
</span><span class='line'>    <span class="nv">description: </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># For binding to the form with ngModel</span>
</span><span class='line'>  <span class="nv">$scope.attributes =</span>
</span><span class='line'>    <span class="nv">name: </span><span class="s">&#39;&#39;</span>
</span><span class='line'>    <span class="nv">description: </span><span class="s">&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.required =</span>
</span><span class='line'>  <span class="nv">name: </span><span class="kc">true</span>
</span><span class='line'>  <span class="nv">description: </span><span class="kc">false</span>
</span><span class='line'>
</span><span class='line'><span class="nv">buildPermutations = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">$scope.permutations.length = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">,</span> <span class="nf">(permutation) -&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">widgetFactory</span><span class="p">.</span><span class="nx">validate</span> <span class="nx">permutation</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutations</span><span class="p">.</span><span class="nx">push</span> <span class="nx">permutation</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.createPermutations = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">widgetStore</span><span class="p">.</span><span class="nx">addWidgets</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutations</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span> <span class="s">&#39;home&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.addAttribute = </span><span class="nf">(key) -&gt;</span>
</span><span class='line'>  <span class="c1"># Tokenize the value</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Then empty the form input</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">buildPermutations</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.isRequired = </span><span class="nf">(key) -&gt;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">required</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">and</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.isDisabled = </span><span class="nf">(key) -&gt;</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.removeAttribute = </span><span class="nf">(key, index) -&gt;</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">buildPermutations</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

<p>and its accompanying Jade template:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nc">.container-fluid</span>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-md-12</span>
</span><span class='line'>      <span class="nt">p</span><span class="nc">.lead</span> Let&#39;s build some widgets.
</span><span class='line'>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-lg-6.col-md-8.col-sm-6</span>
</span><span class='line'>      <span class="nt">form</span><span class="nc">.form-group</span>(
</span><span class='line'>        <span class="na">ng-submit =</span> <span class="s">&quot;addAttribute(&#39;name&#39;)&quot;</span>
</span><span class='line'>        <span class="na">name =</span> <span class="s">&quot;forms.name&quot;</span>
</span><span class='line'>        <span class="na">ng-class =</span> <span class="s">&quot;{ &#39;has-error&#39;: forms.name.$invalid &amp;&amp; forms.name.value.$touched }&quot;</span>
</span><span class='line'>      )
</span><span class='line'>        <span class="nt">label</span><span class="nc">.control-label</span>(
</span><span class='line'>          <span class="na">for =</span> <span class="s">&quot;widget_name&quot;</span>
</span><span class='line'>        ) Name *
</span><span class='line'>
</span><span class='line'>        <span class="nc">.input-group</span>
</span><span class='line'>          <span class="nt">input</span><span class="nc">.form-control</span>(
</span><span class='line'>            <span class="na">id =</span> <span class="s">&quot;widget_name&quot;</span>
</span><span class='line'>            <span class="na">name =</span> <span class="s">&quot;value&quot;</span>
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>            <span class="na">ng-model =</span> <span class="s">&quot;attributes.name&quot;</span>
</span><span class='line'>            <span class="na">ng-required =</span> <span class="s">&quot;isRequired(&#39;name&#39;)&quot;</span>
</span><span class='line'>          )
</span><span class='line'>
</span><span class='line'>          <span class="nc">.input-group-btn</span>
</span><span class='line'>            <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>              <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>              <span class="na">ng-disabled =</span> <span class="s">&quot;isDisabled(&#39;name&#39;)&quot;</span>
</span><span class='line'>            ) Add
</span><span class='line'>
</span><span class='line'>      <span class="nt">form</span><span class="nc">.form-group</span>(
</span><span class='line'>        <span class="na">ng-submit =</span> <span class="s">&quot;addAttribute(&#39;description&#39;)&quot;</span>
</span><span class='line'>        <span class="na">name =</span> <span class="s">&quot;forms.description&quot;</span>
</span><span class='line'>        <span class="na">ng-class =</span> <span class="s">&quot;{ &#39;has-error&#39;: forms.description.$invalid &amp;&amp; forms.description.value.$touched }&quot;</span>
</span><span class='line'>      )
</span><span class='line'>        <span class="nt">label</span><span class="nc">.control-label</span>(
</span><span class='line'>          <span class="na">for =</span> <span class="s">&quot;widget_description&quot;</span>
</span><span class='line'>        ) Description
</span><span class='line'>
</span><span class='line'>        <span class="nc">.input-group</span>
</span><span class='line'>          <span class="nt">input</span><span class="nc">.form-control</span>(
</span><span class='line'>            <span class="na">id =</span> <span class="s">&quot;widget_description&quot;</span>
</span><span class='line'>            <span class="na">name =</span> <span class="s">&quot;value&quot;</span>
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>            <span class="na">ng-model =</span> <span class="s">&quot;attributes.description&quot;</span>
</span><span class='line'>            <span class="na">ng-required =</span> <span class="s">&quot;isRequired(&#39;description&#39;)&quot;</span>
</span><span class='line'>          )
</span><span class='line'>
</span><span class='line'>          <span class="nc">.input-group-btn</span>
</span><span class='line'>            <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>              <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>              <span class="na">ng-disabled =</span> <span class="s">&quot;isDisabled(&#39;description&#39;)&quot;</span>
</span><span class='line'>            ) Add
</span><span class='line'>
</span><span class='line'>    <span class="nc">.col-lg-4.col-md-4.col-sm-6</span>
</span><span class='line'>      <span class="nc">.well</span>
</span><span class='line'>        <span class="nt">h4</span>  Widgets Built
</span><span class='line'>
</span><span class='line'>        <span class="nt">h5</span> Name ()
</span><span class='line'>        <span class="nt">ul</span><span class="nc">.list-unstyled</span>
</span><span class='line'>          <span class="nt">li</span>(
</span><span class='line'>            <span class="na">ng-repeat =</span> <span class="s">&quot;name in permutable_attributes.name&quot;</span>
</span><span class='line'>          ) 
</span><span class='line'>
</span><span class='line'>        <span class="nt">h5</span> Description ()
</span><span class='line'>        <span class="nt">ul</span><span class="nc">.list-unstyled</span>
</span><span class='line'>          <span class="nt">li</span>(
</span><span class='line'>            <span class="na">ng-repeat =</span> <span class="s">&quot;description in permutable_attributes.description&quot;</span>
</span><span class='line'>          ) 
</span><span class='line'>
</span><span class='line'>        <span class="nc">.btn-group</span>
</span><span class='line'>          <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>            <span class="na">ng-click =</span> <span class="s">&quot;submit()&quot;</span>
</span><span class='line'>            <span class="na">ng-disabled =</span> <span class="s">&quot;permutations.length === 0&quot;</span>
</span><span class='line'>          ) Submit
</span><span class='line'>
</span><span class='line'>          <span class="nt">button</span><span class="nc">.btn</span>(
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>            <span class="na">ng-click =</span> <span class="s">&quot;initialize()&quot;</span>
</span><span class='line'>            <span class="na">ng-disabled =</span> <span class="s">&quot;WidgetBuilderService.permutations.length === 0&quot;</span>
</span><span class='line'>          ) Reset
</span></code></pre></td></tr></table></div></figure>

<p>While seeming rather innocuous at first, there are a few problems here:</p>

<h4 id="1.-poor-separation-of-concerns">1. Poor Separation of Concerns</h4>

<p>View logic and state are intermingled with business logic and state. If we were to break up the UI into components, we would find that things like our ngModel bindings (<code>$scope.attributes</code>) and methods like <code>$scope.isRequired</code> and <code>$scope.isDisabled</code> could be isolated within a directive.</p>

<p>Furthermore, breaking the UI up into directives will help us solve the next issue&#8230;</p>

<h4 id="2.-it&#39;s-not-reusable!">2. It&#39;s Not Reusable!</h4>

<p>Now, I don&#39;t advocate immediately jumping into complicated abstractions&#8211;it&#39;s good to work iteratively. But as soon as this needs to be reused, it&#39;s time to refactor to keep things DRY.</p>

<blockquote>
<p>Refactor early, refactor often.</p>
</blockquote>

<h2 id="teasing-out-the-layers">Teasing Out The Layers</h2>

<p>Compare that first controller and template with the following:</p>

<p><code>widget-builder-controller.coffee</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">$scope.WidgetBuilderService = </span><span class="nx">WidgetBuilderService</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$scope.createPermutations = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">WidgetBuilderService</span><span class="p">.</span><span class="nx">createPermutations</span><span class="p">().</span><span class="nx">then</span> <span class="nf">(widgets) -&gt;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;look at all these widgets we built!&#39;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">table</span> <span class="nx">widgets</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span> <span class="s">&#39;home&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p><code>widget-builder.jade</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nc">.container-fluid</span>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-md-12</span>
</span><span class='line'>      <span class="nt">p</span><span class="nc">.lead</span> Let&#39;s build some widgets.
</span><span class='line'>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-lg-6.col-md-8.col-sm-6</span>
</span><span class='line'>      <span class="nt">kc-permutation-builder</span>(
</span><span class='line'>        <span class="na">service =</span> <span class="s">&quot;WidgetBuilderService&quot;</span>
</span><span class='line'>      )
</span><span class='line'>        <span class="nt">kc-permutable-input</span>(
</span><span class='line'>          <span class="na">name =</span> <span class="s">&quot;name&quot;</span>
</span><span class='line'>          <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>          <span class="na">required</span>
</span><span class='line'>        ) Name
</span><span class='line'>
</span><span class='line'>        <span class="nt">kc-permutable-input</span>(
</span><span class='line'>          <span class="na">name =</span> <span class="s">&quot;description&quot;</span>
</span><span class='line'>          <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>        ) Description
</span><span class='line'>
</span><span class='line'>    <span class="nc">.col-lg-4.col-md-4.col-sm-6</span>
</span><span class='line'>      <span class="nc">.well</span>
</span><span class='line'>        <span class="nt">h4</span>  Widgets Built
</span><span class='line'>
</span><span class='line'>        <span class="nt">h5</span> Name ()
</span><span class='line'>        <span class="nt">ul</span><span class="nc">.list-unstyled</span>
</span><span class='line'>          <span class="nt">li</span>(
</span><span class='line'>            <span class="na">ng-repeat =</span> <span class="s">&quot;name in WidgetBuilderService.permutable_attributes.name&quot;</span>
</span><span class='line'>          ) 
</span><span class='line'>
</span><span class='line'>        <span class="nt">h5</span> Description ()
</span><span class='line'>        <span class="nt">ul</span><span class="nc">.list-unstyled</span>
</span><span class='line'>          <span class="nt">li</span>(
</span><span class='line'>            <span class="na">ng-repeat =</span> <span class="s">&quot;description in WidgetBuilderService.permutable_attributes.description&quot;</span>
</span><span class='line'>          ) 
</span><span class='line'>
</span><span class='line'>        <span class="nc">.btn-group</span>
</span><span class='line'>          <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>            <span class="na">ng-click =</span> <span class="s">&quot;submit()&quot;</span>
</span><span class='line'>            <span class="na">ng-disabled =</span> <span class="s">&quot;WidgetBuilderService.permutations.length === 0&quot;</span>
</span><span class='line'>          ) Submit
</span><span class='line'>
</span><span class='line'>          <span class="nt">button</span><span class="nc">.btn</span>(
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>            <span class="na">ng-click =</span> <span class="s">&quot;WidgetBuilderService.initialize()&quot;</span>
</span><span class='line'>            <span class="na">ng-disabled =</span> <span class="s">&quot;WidgetBuilderService.permutations.length === 0&quot;</span>
</span><span class='line'>          ) Reset
</span></code></pre></td></tr></table></div></figure>

<h3 id="thinking-purely-in-terms-of-business-object-state-and-logic">Thinking purely in terms of business object state and logic</h3>

<p>Without even considering a UI, how would you describe the state of a collection of attributes to generate permutations from? How would you design an API to manipulate that state?</p>

<p><code>permutation-builder-service.coffee</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">PermutationBuilderService</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">@initialize</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name initialize</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Method used to reset service to an empty state.</span>
</span><span class='line'><span class="cm">  Override this method to define attributes for a permutable resource.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">initialize: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="c1"># Regular attributes that get added to each permutation</span>
</span><span class='line'>    <span class="vi">@attributes = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Permutable attributes</span>
</span><span class='line'>    <span class="vi">@permutable_attributes = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Collection of permutations</span>
</span><span class='line'>    <span class="vi">@permutations = </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name addAttribute</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Adds a permutable attribute</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @returns {Boolean} Whether attribute was added successfully or not.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">addAttribute: </span><span class="nf">(key, value) -&gt;</span>
</span><span class='line'>    <span class="nv">bucket = </span><span class="nx">@permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">throw</span> <span class="nb">Error</span> <span class="s">&quot;Invalid key: &#39;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s">&#39;&quot;</span> <span class="k">unless</span> <span class="nx">bucket</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">contains</span> <span class="nx">bucket</span><span class="p">,</span> <span class="nx">value</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&quot;&#39;</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">&#39; already entered.&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Add the value to permute against</span>
</span><span class='line'>    <span class="nx">bucket</span><span class="p">.</span><span class="nx">push</span> <span class="nx">value</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># And generate the permutations</span>
</span><span class='line'>    <span class="nx">@buildPermutations</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name buildPermutations</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Builds permutations of the resource.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @returns {Array} Collection of permutations</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">buildPermutations: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="c1"># Empty our collection of permutations from previous runs</span>
</span><span class='line'>    <span class="vi">@permutations.length = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">@permutable_attributes</span><span class="p">,</span> <span class="nf">(permutation) =&gt;</span>
</span><span class='line'>      <span class="c1"># Extend common attributes onto each permutation</span>
</span><span class='line'>      <span class="nv">resource = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">permutation</span><span class="p">,</span> <span class="nx">@attributes</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">@permutations</span><span class="p">.</span><span class="nx">push</span> <span class="nx">resource</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">@permutations</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name createPermutations</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Issues a request to persist permutations.</span>
</span><span class='line'><span class="cm">  Override this method to define how a permutable resource gets persisted.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">createPermutations: </span><span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name removeAttribute</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Removes a permutable attribute by index</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @returns {Boolean} - true if item successfully removed</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">removeAttribute: </span><span class="nf">(key, index) -&gt;</span>
</span><span class='line'>    <span class="nv">bucket = </span><span class="nx">@permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">throw</span> <span class="nb">Error</span> <span class="s">&quot;Invalid key: &#39;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s">&#39;&quot;</span> <span class="k">unless</span> <span class="nx">bucket</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">removed = </span><span class="nx">bucket</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">@buildPermutations</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">removed</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>

<h3 id="thinking-of-your-ui-in-terms-of-a-tree-of-components">Thinking of your UI in terms of a tree of components</h3>

<p><code>permutation-builder-directive.coffee</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;kcPermutationBuilder&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">restrict: </span><span class="s">&#39;E&#39;</span>
</span><span class='line'>  <span class="nv">controller: </span><span class="s">&#39;KcPermutationBuilderController&#39;</span>
</span><span class='line'>  <span class="nv">scope:</span>
</span><span class='line'>    <span class="nv">service: </span><span class="s">&#39;=&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;KcPermutationBuilderController&#39;</span><span class="p">,</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">  $scope</span>
</span><span class='line'><span class="nf">) -&gt;</span>
</span><span class='line'>  <span class="vi">@permutable_attributes = </span><span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@addAttribute = </span><span class="nx">angular</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">addAttribute</span>
</span></code></pre></td></tr></table></div></figure>

<p><code>permutable-input-directive.coffee</code></p>

<ul>
<li>The main building block of this UI flow. Each permutable attribute requires a miniature form with a single input, input label, submit button, and error message handling. This directive encapsulates all of that.</li>
</ul>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;kcPermutableInput&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">require: </span><span class="s">&#39;^kcPermutationBuilder&#39;</span>
</span><span class='line'>  <span class="nv">restrict: </span><span class="s">&#39;E&#39;</span>
</span><span class='line'>  <span class="nv">templateUrl: </span><span class="s">&#39;/permutation/_permutable-input.html&#39;</span>
</span><span class='line'>  <span class="nv">transclude: </span><span class="kc">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">scope:</span>
</span><span class='line'>    <span class="nv">name: </span><span class="s">&#39;@name&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">link: </span><span class="nf">(scope, element, attrs, kcPermutationBuilder) -&gt;</span>
</span><span class='line'>    <span class="c1"># Ensure input IDs are unique</span>
</span><span class='line'>    <span class="nv">scope.input_id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span> <span class="s">&#39;permutatable_input_&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.state =</span>
</span><span class='line'>      <span class="nv">value: </span><span class="s">&#39;&#39;</span>
</span><span class='line'>      <span class="nv">is_required: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">required</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.isDisabled = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">scope</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name isRequired</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    An input is no longer required if at least 1 value has already been entered</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Boolean}</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.isRequired = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">required</span><span class="o">?</span> <span class="o">and</span>
</span><span class='line'>        <span class="nx">kcPermutationBuilder</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">scope</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.submit = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">is_added = </span><span class="nx">kcPermutationBuilder</span><span class="p">.</span><span class="nx">addAttribute</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">scope</span><span class="p">.</span><span class="nx">name</span>
</span><span class='line'>        <span class="nx">scope</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="nx">is_added</span>
</span><span class='line'>        <span class="nv">scope.state.value = </span><span class="s">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p><code>_permutable-input.jade</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">form</span><span class="nc">.form-group</span>(
</span><span class='line'>  <span class="na">ng-submit =</span> <span class="s">&quot;submit()&quot;</span>
</span><span class='line'>  <span class="na">name =</span> <span class="s">&quot;form&quot;</span>
</span><span class='line'>  <span class="na">ng-class =</span> <span class="s">&quot;{ &#39;has-error&#39;: form.$invalid &amp;&amp; form.value.$touched }&quot;</span>
</span><span class='line'>)
</span><span class='line'>  <span class="nt">label</span><span class="nc">.control-label</span>(
</span><span class='line'>    <span class="na">for =</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>  )
</span><span class='line'>    <span class="nt">span</span>(<span class="na">ng-transclude</span>)
</span><span class='line'>    <span class="nt">span</span>(<span class="na">ng-if=</span><span class="s">&quot;state.is_required&quot;</span>) *
</span><span class='line'>
</span><span class='line'>  <span class="nc">.input-group</span>
</span><span class='line'>    <span class="nt">input</span><span class="nc">.form-control</span>(
</span><span class='line'>      <span class="na">id =</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>      <span class="na">name =</span> <span class="s">&quot;value&quot;</span>
</span><span class='line'>      <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>      <span class="na">ng-model =</span> <span class="s">&quot;state.value&quot;</span>
</span><span class='line'>      <span class="na">ng-required =</span> <span class="s">&quot;isRequired()&quot;</span>
</span><span class='line'>    )
</span><span class='line'>
</span><span class='line'>    <span class="nc">.input-group-btn</span>
</span><span class='line'>      <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>        <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>        <span class="na">ng-disabled =</span> <span class="s">&quot;isDisabled()&quot;</span>
</span><span class='line'>      ) Add
</span></code></pre></td></tr></table></div></figure>

<p>kc-permutable-attribute<br>
*</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p><a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>, Wikipedia&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

<li id="fn2">
<p><a href="http://www.objectmentor.com/resources/articles/srp.pdf">SRP: The Single Responsibility Principle</a> by Robert C. Martin&nbsp;<a href="#fnref2" rev="footnote">&#8617;</a></p>
</li>

<li id="fn3">
<p><a href="http://blog.codinghorror.com/curlys-law-do-one-thing/">Curly&#39;s Law</a>, Coding Horror, by Jeff Atwood&nbsp;<a href="#fnref3" rev="footnote">&#8617;</a></p>
</li>

<li id="fn4">
<p><a href="http://en.wikipedia.org/wiki/Separation_of_concerns">Separation of Concerns</a>, Wikipedia&nbsp;<a href="#fnref4" rev="footnote">&#8617;</a></p>
</li>

<li id="fn5">
<p><a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don&#39;t Repeat Yourself</a>, Wikipedia&nbsp;<a href="#fnref5" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Kevin Crawford</span></span>

      








  


<time datetime="2015-05-30T17:15:00-07:00" pubdate data-updated="true">May 30<span>th</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/02/09/introducing-ng-coffeeplate/" title="Previous Post: Introducing: ng-coffeeplate">&laquo; Introducing: ng-coffeeplate</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/30/architectural-best-practices-for-dry/">Architectural Best Practices for Maintainable, Reusable UIs in Angular</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/09/introducing-ng-coffeeplate/">Introducing: Ng-coffeeplate</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/20/configuring-a-production-node-js-and-mongodb-environment-in-ubuntu-on-an-amazon-ec2-instance/">Configuring a Production Node.js and MongoDB Environment in Ubuntu on an Amazon EC2 Instance</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/30/cloning-an-existing-installation-of-octopress/">Cloning an Existing Installation of Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/09/when-a-fire-starts-to-burn/">When a Fire Starts to Burn</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/kvcrawford">@kvcrawford</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kvcrawford',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:kvcrawford">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "kvcrawford"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/100412605131936780000?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Kevin Crawford -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kvcrawford';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kvcrawford.github.io/blog/2015/05/30/architectural-best-practices-for-dry/';
        var disqus_url = 'http://kvcrawford.github.io/blog/2015/05/30/architectural-best-practices-for-dry/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
