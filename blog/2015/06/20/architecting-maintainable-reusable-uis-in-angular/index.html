
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Architecting Maintainable, Reusable UIs in Angular: A Case Study - Kevin Crawford, Software Engineer</title>
  <meta name="author" content="Kevin Crawford">

  
  <meta name="description" content="After spending substantial time working in-depth in Angular land, and with further influence from incursions into Flux &amp; React, I&#39;ve come to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kvcrawford.github.io/blog/2015/06/20/architecting-maintainable-reusable-uis-in-angular">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kevin Crawford, Software Engineer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44222285-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Kevin Crawford, Software Engineer</a></h1>
  
    <h2>Front-End Specialist &middot;  Full-Stack Generalist</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kvcrawford.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/resume">R&eacute;sum&eacute;</a></li>
  <li><a href="/contact">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Architecting Maintainable, Reusable UIs in Angular: A Case Study</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-20T13:01:00-07:00" pubdate data-updated="true">Jun 20<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>After spending substantial time working in-depth in Angular land, and with further influence from incursions into Flux &amp; React, I&#39;ve come to develop certain opinions on how to best architect non-trivial, data-driven UI flows in an Angular application.</p>

<p>What follows is a case study of a real-world UI problem, solved with the guidance of well-established principles and patterns in software design.</p>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder">Read the code on Github</a> &bull; <a href="http://kvcrawford.github.io/ng-permutation-builder/">See the live demo</a></p>

<h2 id="the-user-story">The User Story</h2>

<p>Jill works for <em>The Widget Factory</em>, a company in the business of making widgets. Oftentimes, she wants to be able to test how slightly different widgets perform against each other.</p>

<p>Rather than waste time creating the otherwise-same widget several times over, she would like to be able to quickly generate the different permutations, and be done with it.</p>

<!-- more -->

<h2 id="some-guiding-principles">Some Guiding Principles</h2>

<p>Before we begin, I&#39;d like to highlight some design principles that will guide our implementation. While the purpose of this article is to <em>demonstrate</em> rather than explain these topics in detail, I&#39;ve included links for further reading.</p>

<ul>
<li>The Single Responsibility Principle (SRP) <sup><a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">1</a></sup> <sup><a href="http://www.objectmentor.com/resources/articles/srp.pdf">2</a></sup></li>
<li>Separation of Concerns (SoC) <sup><a href="http://en.wikipedia.org/wiki/Separation_of_concerns">3</a></sup></li>
<li>Don&#39;t Repeat Yourself (DRY) <sup><a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">4</a></sup></li>
</ul>

<p>We&#39;ll proceed iteratively. First, make it workâ€”then, refactor.</p>

<h2 id="first:-how-do-we-generate-permutations?">First: how do we generate permutations?</h2>

<p>TDD for this type of stuff is a must. Consider this object of <em>permutable attributes</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">permutable_attributes =</span>
</span><span class='line'>  <span class="nv">name: </span><span class="p">[</span><span class="s">&#39;Foobar&#39;</span><span class="p">,</span> <span class="s">&#39;Bizbat&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="nv">description: </span><span class="p">[</span><span class="s">&#39;I pity the foo.&#39;</span><span class="p">,</span> <span class="s">&#39;Lorem ipsum.&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>From this, we would generate 4 possible permutations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="nv">name: </span><span class="s">&#39;Foobar&#39;</span>
</span><span class='line'>  <span class="nv">description: </span><span class="s">&#39;I pity the foo.&#39;</span>
</span><span class='line'><span class="p">,</span>
</span><span class='line'>  <span class="nv">name: </span><span class="s">&#39;Foobar&#39;</span>
</span><span class='line'>  <span class="nv">description: </span><span class="s">&#39;Lorem ipsum.&#39;</span>
</span><span class='line'><span class="p">,</span>
</span><span class='line'>  <span class="nv">name: </span><span class="s">&#39;Bizbat&#39;</span>
</span><span class='line'>  <span class="nv">description: </span><span class="s">&#39;I pity the foo.&#39;</span>
</span><span class='line'><span class="p">,</span>
</span><span class='line'>  <span class="nv">name: </span><span class="s">&#39;Bizbat&#39;</span>
</span><span class='line'>  <span class="nv">description: </span><span class="s">&#39;Lorem ipsum.&#39;</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>Let&#39;s expand on those expectations: <a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/test/permutation-factory.spec.coffee">permutation-factory.spec.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">describe</span> <span class="s">&#39;permutationFactory:&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">permutationFactory = </span><span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">beforeEach</span> <span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">beforeEach</span> <span class="nx">inject</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">    _permutationFactory_</span>
</span><span class='line'><span class="nf">  ) -&gt;</span>
</span><span class='line'>    <span class="nv">permutationFactory = </span><span class="nx">_permutationFactory_</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">describe</span> <span class="s">&#39;permute:&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="c1"># Expected result for 2*2</span>
</span><span class='line'>    <span class="nv">result_2x2 = </span><span class="p">[</span>
</span><span class='line'>      <span class="nv">name: </span><span class="s">&#39;foo&#39;</span>
</span><span class='line'>      <span class="nv">attr: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>    <span class="p">,</span>
</span><span class='line'>      <span class="nv">name: </span><span class="s">&#39;foo&#39;</span>
</span><span class='line'>      <span class="nv">attr: </span><span class="s">&#39;bat&#39;</span>
</span><span class='line'>    <span class="p">,</span>
</span><span class='line'>      <span class="nv">name: </span><span class="s">&#39;bar&#39;</span>
</span><span class='line'>      <span class="nv">attr: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>    <span class="p">,</span>
</span><span class='line'>      <span class="nv">name: </span><span class="s">&#39;bar&#39;</span>
</span><span class='line'>      <span class="nv">attr: </span><span class="s">&#39;bat&#39;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span> <span class="s">&#39;Should generate 4 permutations from 2*2 attributes.&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">permutable_attributes =</span>
</span><span class='line'>        <span class="nv">name: </span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">attr: </span><span class="p">[</span><span class="s">&#39;biz&#39;</span><span class="p">,</span> <span class="s">&#39;bat&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutations = </span><span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">permutations</span><span class="p">).</span><span class="nx">toEqual</span> <span class="nx">result_2x2</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span> <span class="s">&#39;Should ignore attributes without any values.&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="c1"># Some attributes won&#39;t be required--we want to skip those.</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutable_attributes =</span>
</span><span class='line'>        <span class="nv">name: </span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">empty: </span><span class="p">[]</span>
</span><span class='line'>        <span class="nv">attr: </span><span class="p">[</span><span class="s">&#39;biz&#39;</span><span class="p">,</span> <span class="s">&#39;bat&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutations = </span><span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">permutations</span><span class="p">).</span><span class="nx">toEqual</span> <span class="nx">result_2x2</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span> <span class="s">&#39;Should ignore empty attributes at the end of the object.&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">permutable_attributes =</span>
</span><span class='line'>        <span class="nv">name: </span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">attr: </span><span class="p">[</span><span class="s">&#39;biz&#39;</span><span class="p">,</span> <span class="s">&#39;bat&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">empty: </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutations = </span><span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">permutations</span><span class="p">).</span><span class="nx">toEqual</span> <span class="nx">result_2x2</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span> <span class="s">&#39;Should generate 6 permutations from 2*1*0*3 attributes.&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">permutable_attributes =</span>
</span><span class='line'>        <span class="nv">name: </span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">type: </span><span class="p">[</span><span class="s">&#39;biz&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">empty: </span><span class="p">[]</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="p">[</span><span class="s">&#39;bing&#39;</span><span class="p">,</span> <span class="s">&#39;bang&#39;</span><span class="p">,</span> <span class="s">&#39;boom&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutations = </span><span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">permutations</span><span class="p">).</span><span class="nx">toEqual</span> <span class="p">[</span>
</span><span class='line'>        <span class="nv">name: </span><span class="s">&#39;foo&#39;</span>
</span><span class='line'>        <span class="nv">type: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="s">&#39;bing&#39;</span>
</span><span class='line'>      <span class="p">,</span>
</span><span class='line'>        <span class="nv">name: </span><span class="s">&#39;foo&#39;</span>
</span><span class='line'>        <span class="nv">type: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="s">&#39;bang&#39;</span>
</span><span class='line'>      <span class="p">,</span>
</span><span class='line'>        <span class="nv">name: </span><span class="s">&#39;foo&#39;</span>
</span><span class='line'>        <span class="nv">type: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="s">&#39;boom&#39;</span>
</span><span class='line'>      <span class="p">,</span>
</span><span class='line'>        <span class="nv">name: </span><span class="s">&#39;bar&#39;</span>
</span><span class='line'>        <span class="nv">type: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="s">&#39;bing&#39;</span>
</span><span class='line'>      <span class="p">,</span>
</span><span class='line'>        <span class="nv">name: </span><span class="s">&#39;bar&#39;</span>
</span><span class='line'>        <span class="nv">type: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="s">&#39;bang&#39;</span>
</span><span class='line'>      <span class="p">,</span>
</span><span class='line'>        <span class="nv">name: </span><span class="s">&#39;bar&#39;</span>
</span><span class='line'>        <span class="nv">type: </span><span class="s">&#39;biz&#39;</span>
</span><span class='line'>        <span class="nv">desc: </span><span class="s">&#39;boom&#39;</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span> <span class="s">&#39;Should invoke an optional callback for each permutation&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">callback = </span><span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpy</span> <span class="s">&#39;callback&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutable_attributes =</span>
</span><span class='line'>        <span class="nv">name: </span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">attr: </span><span class="p">[</span><span class="s">&#39;biz&#39;</span><span class="p">,</span> <span class="s">&#39;bat&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">permutations = </span><span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">permutable_attributes</span><span class="p">,</span> <span class="nx">callback</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">calls</span><span class="p">.</span><span class="nx">count</span><span class="p">()).</span><span class="nx">toBe</span> <span class="mi">4</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">calls</span><span class="p">.</span><span class="nx">argsFor</span><span class="p">(</span><span class="nx">i</span><span class="p">)).</span><span class="nx">toEqual</span> <span class="p">[</span><span class="nx">result_2x2</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>

<p>With tests in place, <em>now</em> we can do our implementation: <a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/service/permutation-factory.coffee">permutation-factory.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name permutationFactory</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">Utility service for generating permutations of a resource.</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">factory</span> <span class="s">&#39;permutationFactory&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name permute</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Generates permutations from a permutable_attributes object.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @param {Object} permutable_attributes</span>
</span><span class='line'><span class="cm">  @param {[Callback]} callback - Optional, invoked for each permutation</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @callback callback</span>
</span><span class='line'><span class="cm">  @param {Object} permutation</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @returns {Array} - Collection of permutations</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @example</span>
</span><span class='line'><span class="cm">  ```coffeescript</span>
</span><span class='line'><span class="cm">  permutations = permutationFactory.permute</span>
</span><span class='line'><span class="cm">    name: [&#39;Foobar&#39;, &#39;Bizbat&#39;]</span>
</span><span class='line'><span class="cm">    description: [&#39;I pity the foo.&#39;, &#39;Lorem ipsum.&#39;]</span>
</span><span class='line'><span class="cm">  ```</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">permute: </span><span class="nf">(permutable_attributes, callback) -&gt;</span>
</span><span class='line'>    <span class="nv">permutations = </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">recurse = </span><span class="nf">(keys, payload = {}, position = 0) -&gt;</span>
</span><span class='line'>      <span class="c1"># We&#39;ve finished constructing the permutation, exit call stack</span>
</span><span class='line'>      <span class="k">if</span> <span class="nx">position</span> <span class="o">is</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'>        <span class="nv">permutation = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">payload</span>
</span><span class='line'>        <span class="nx">callback</span><span class="o">?</span> <span class="nx">permutation</span>
</span><span class='line'>        <span class="nx">permutations</span><span class="p">.</span><span class="nx">push</span> <span class="nx">permutation</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Grab the current key</span>
</span><span class='line'>      <span class="nv">key = </span><span class="nx">keys</span><span class="p">[</span><span class="nx">position</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># There are no values for this attribute, skip it</span>
</span><span class='line'>      <span class="k">if</span> <span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
</span><span class='line'>        <span class="nx">recurse</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">position</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Otherwise, recurse for each possible value of this attribute</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>          <span class="nx">payload</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">recurse</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">position</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">recurse</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">permutations</span>
</span></code></pre></td></tr></table></div></figure>

<p>With our <code>permute</code> algorithm complete, now we can wire up a UI.</p>

<h2 id="a-first-iteration">A First Iteration</h2>

<p>One of the most common pitfalls seen in Angular apps are bloated controllers. It can be tempting to wedge bits of logic here and there, as it&#39;s easy at the time. Unfortunately, the controller quickly turns into a tangled mess. Consider the following implementation of our permutation builder:</p>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/widget/controller/spaghetti-widget-builder-controller.coffee">spaghetti-widget-builder-controller.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.widget&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;SpaghettiWidgetBuilderController&#39;</span><span class="p">,</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">  $scope</span>
</span><span class='line'><span class="nf">  $state</span>
</span><span class='line'><span class="nf">  permutationFactory</span>
</span><span class='line'><span class="nf">  widgetFactory</span>
</span><span class='line'><span class="nf">  widgetStore</span>
</span><span class='line'><span class="nf">) -&gt;</span>
</span><span class='line'>  <span class="c1"># Placeholder object to hold references for our ngForm instances</span>
</span><span class='line'>  <span class="nv">$scope.forms = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name initialize</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Resets state, called if the user hits the reset button.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  The `do` immediately invokes our method to initialize state when</span>
</span><span class='line'><span class="cm">  controller first loads.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">do</span> <span class="nv">$scope.initialize = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nv">$scope.permutations = </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$scope.permutable_attributes =</span>
</span><span class='line'>      <span class="nv">name: </span><span class="p">[]</span>
</span><span class='line'>      <span class="nv">description: </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># For binding to the form with ngModel</span>
</span><span class='line'>    <span class="nv">$scope.attributes =</span>
</span><span class='line'>      <span class="nv">name: </span><span class="s">&#39;&#39;</span>
</span><span class='line'>      <span class="nv">description: </span><span class="s">&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># We need to specify which fields are required. We can&#39;t just use a</span>
</span><span class='line'>  <span class="c1"># &#39;required&#39; attribute on the input tag, because it will no longer</span>
</span><span class='line'>  <span class="c1"># be required once at least 1 value has been entered.</span>
</span><span class='line'>  <span class="nv">$scope.required =</span>
</span><span class='line'>    <span class="nv">name: </span><span class="kc">true</span>
</span><span class='line'>    <span class="nv">description: </span><span class="kc">false</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name buildPermutations</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Private function called every time an attribute is added or removed.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">buildPermutations = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nv">$scope.permutations.length = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># At least we have the `permutationFactory` and `widgetFactory`,</span>
</span><span class='line'>    <span class="c1"># which are more obvious as candidates for separate services.</span>
</span><span class='line'>    <span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">,</span> <span class="nf">(permutation) -&gt;</span>
</span><span class='line'>      <span class="k">if</span> <span class="nx">widgetFactory</span><span class="p">.</span><span class="nx">validate</span> <span class="nx">permutation</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutations</span><span class="p">.</span><span class="nx">push</span> <span class="nx">permutation</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name createPermutations</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Persists the permutations and redirects to home page.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.createPermutations = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">widgetStore</span><span class="p">.</span><span class="nx">addWidgets</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutations</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span> <span class="s">&#39;home&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name addAttribute</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Adds an attribute to generate permutations from, then empties the form input.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @param {String} key - Attribute name</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.addAttribute = </span><span class="nf">(key) -&gt;</span>
</span><span class='line'>    <span class="c1"># Tokenize the value</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Then empty the form input</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">buildPermutations</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name isRequired</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Used with ng-required, determines if at least 1 value has been entered or not.</span>
</span><span class='line'><span class="cm">  This view logic would fit much more nicely in a directive.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @param {String} key - Attribute name</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @returns {Boolean}</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.isRequired = </span><span class="nf">(key) -&gt;</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">required</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">and</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name isDisabled</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  We don&#39;t want the submit button to be enabled if input is empty.</span>
</span><span class='line'><span class="cm">  Also a good candidate for inclusion in a directive.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @param {String} key - Attribute name</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @returns {Boolean}</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.isDisabled = </span><span class="nf">(key) -&gt;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name removeAttribute</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Removes a permutable attribute, then re-generates permutations.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  @param {String} key - Attribute name</span>
</span><span class='line'><span class="cm">  @param {Integer} index - Index in the permutable attribute array.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.removeAttribute = </span><span class="nf">(key, index) -&gt;</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">buildPermutations</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/widget/spaghetti-widget-builder.jade">spaghetti-widget-builder.jade</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="c">//- Can you spot all the repeating markup? Just imagine if we had more fields!</span>
</span><span class='line'><span class="nc">.container-fluid</span>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-md-12</span>
</span><span class='line'>      <span class="nt">p</span><span class="nc">.lead</span> Let&#39;s build some widgets.
</span><span class='line'>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-lg-6.col-md-8.col-sm-6</span>
</span><span class='line'>      <span class="nt">form</span><span class="nc">.form-group</span>(
</span><span class='line'>        <span class="na">ng-submit =</span> <span class="s">&quot;addAttribute(&#39;name&#39;)&quot;</span>
</span><span class='line'>        <span class="na">name =</span> <span class="s">&quot;forms.name&quot;</span>
</span><span class='line'>        <span class="na">ng-class =</span> <span class="s">&quot;{ &#39;has-error&#39;: forms.name.$invalid &amp;&amp; forms.name.value.$touched }&quot;</span>
</span><span class='line'>      )
</span><span class='line'>        <span class="nt">label</span><span class="nc">.control-label</span>(
</span><span class='line'>          <span class="na">for =</span> <span class="s">&quot;widget_name&quot;</span>
</span><span class='line'>        ) Name*
</span><span class='line'>
</span><span class='line'>        <span class="nc">.input-group</span>
</span><span class='line'>          <span class="nt">input</span><span class="nc">.form-control</span>(
</span><span class='line'>            <span class="na">id =</span> <span class="s">&quot;widget_name&quot;</span>
</span><span class='line'>            <span class="na">name =</span> <span class="s">&quot;value&quot;</span>
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>            <span class="na">ng-model =</span> <span class="s">&quot;attributes.name&quot;</span>
</span><span class='line'>            <span class="na">ng-required =</span> <span class="s">&quot;isRequired(&#39;name&#39;)&quot;</span>
</span><span class='line'>          )
</span><span class='line'>
</span><span class='line'>          <span class="nc">.input-group-btn</span>
</span><span class='line'>            <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>              <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>              <span class="na">ng-disabled =</span> <span class="s">&quot;isDisabled(&#39;name&#39;)&quot;</span>
</span><span class='line'>            ) Add
</span><span class='line'>
</span><span class='line'>      <span class="nt">form</span><span class="nc">.form-group</span>(
</span><span class='line'>        <span class="na">ng-submit =</span> <span class="s">&quot;addAttribute(&#39;description&#39;)&quot;</span>
</span><span class='line'>        <span class="na">name =</span> <span class="s">&quot;forms.description&quot;</span>
</span><span class='line'>        <span class="na">ng-class =</span> <span class="s">&quot;{ &#39;has-error&#39;: forms.description.$invalid &amp;&amp; forms.description.value.$touched }&quot;</span>
</span><span class='line'>      )
</span><span class='line'>        <span class="nt">label</span><span class="nc">.control-label</span>(
</span><span class='line'>          <span class="na">for =</span> <span class="s">&quot;widget_description&quot;</span>
</span><span class='line'>        ) Description
</span><span class='line'>
</span><span class='line'>        <span class="nc">.input-group</span>
</span><span class='line'>          <span class="nt">input</span><span class="nc">.form-control</span>(
</span><span class='line'>            <span class="na">id =</span> <span class="s">&quot;widget_description&quot;</span>
</span><span class='line'>            <span class="na">name =</span> <span class="s">&quot;value&quot;</span>
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>            <span class="na">ng-model =</span> <span class="s">&quot;attributes.description&quot;</span>
</span><span class='line'>            <span class="na">ng-required =</span> <span class="s">&quot;isRequired(&#39;description&#39;)&quot;</span>
</span><span class='line'>          )
</span><span class='line'>
</span><span class='line'>          <span class="nc">.input-group-btn</span>
</span><span class='line'>            <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>              <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>              <span class="na">ng-disabled =</span> <span class="s">&quot;isDisabled(&#39;description&#39;)&quot;</span>
</span><span class='line'>            ) Add
</span><span class='line'>
</span><span class='line'>    <span class="nc">.col-lg-4.col-md-4.col-sm-6</span>
</span><span class='line'>      <span class="nc">.panel.panel-default</span>
</span><span class='line'>        <span class="nc">.panel-heading</span>
</span><span class='line'>            <span class="nt">h4</span><span class="nc">.panel-title</span> {{permutations.length}} Widgets Built
</span><span class='line'>
</span><span class='line'>        <span class="nc">.panel-body</span>
</span><span class='line'>          <span class="nc">.panel.panel-default</span>
</span><span class='line'>            <span class="nc">.panel-heading</span>
</span><span class='line'>              <span class="nt">strong</span> Name ({{permutable_attributes.name.length}})
</span><span class='line'>
</span><span class='line'>            <span class="nt">ul</span><span class="nc">.list-group</span>
</span><span class='line'>              <span class="nt">li</span><span class="nc">.list-group-item</span>(
</span><span class='line'>                <span class="na">ng-repeat =</span> <span class="s">&quot;name in permutable_attributes.name&quot;</span>
</span><span class='line'>              )
</span><span class='line'>                <span class="nt">span</span> {{name}}
</span><span class='line'>                <span class="nt">button</span><span class="nc">.btn.close</span>(
</span><span class='line'>                  <span class="na">ng-click =</span> <span class="s">&quot;removeAttribute(&#39;name&#39;, $index)&quot;</span>
</span><span class='line'>                ) &amp;times;
</span><span class='line'>
</span><span class='line'>          <span class="nc">.panel.panel-default</span>
</span><span class='line'>            <span class="nc">.panel-heading</span>
</span><span class='line'>              <span class="nt">strong</span> Description ({{permutable_attributes.description.length}})
</span><span class='line'>
</span><span class='line'>            <span class="nt">ul</span><span class="nc">.list-group</span>
</span><span class='line'>              <span class="nt">li</span><span class="nc">.list-group-item</span>(
</span><span class='line'>                <span class="na">ng-repeat =</span> <span class="s">&quot;description in permutable_attributes.description&quot;</span>
</span><span class='line'>              )
</span><span class='line'>                <span class="nt">span</span> {{description}}
</span><span class='line'>                <span class="nt">button</span><span class="nc">.btn.close</span>(
</span><span class='line'>                  <span class="na">ng-click =</span> <span class="s">&quot;removeAttribute(&#39;description&#39;, $index)&quot;</span>
</span><span class='line'>                ) &amp;times;
</span><span class='line'>
</span><span class='line'>        <span class="nc">.panel-footer</span>
</span><span class='line'>          <span class="nc">.btn-group</span>
</span><span class='line'>            <span class="nt">button</span><span class="nc">.btn.btn-primary</span>(
</span><span class='line'>              <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>              <span class="na">ng-click =</span> <span class="s">&quot;createPermutations()&quot;</span>
</span><span class='line'>              <span class="na">ng-disabled =</span> <span class="s">&quot;permutations.length === 0&quot;</span>
</span><span class='line'>            ) Submit
</span><span class='line'>
</span><span class='line'>            <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>              <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>              <span class="na">ng-click =</span> <span class="s">&quot;initialize()&quot;</span>
</span><span class='line'>              <span class="na">ng-disabled =</span> <span class="s">&quot;permutations.length === 0&quot;</span>
</span><span class='line'>            ) Reset
</span></code></pre></td></tr></table></div></figure>

<p>It works! Cool! But, there are a few problems here:</p>

<ul>
<li>There&#39;s poor separation of concerns: view logic and state (<code>isRequired</code>, <code>isDisabled</code>) are intermingled with business logic and state.</li>
<li>What if we want to add new features, like permutable images? Or videos? This controller and template will keep getting bigger.</li>
<li>What if we want to add an additional step, to review the permutations we&#39;ve generated before saving them? Having the data model so tightly coupled to the controller becomes problematic.</li>
<li>What we have isn&#39;t very reusable. What if we want to create another permutation builder for <em>Gadgets</em>?</li>
</ul>

<p><em>Note that we still have the <a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/service/permutation-factory.coffee">permutationFactory</a> and <a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/widget/service/widget-factory.coffee">widgetFactory</a>, which were more obvious candidates for separate services.</em></p>

<h2 id="teasing-out-the-layers">Teasing Out The Layers</h2>

<p>By isolating our concerns into separate layers, we can create something that is both easier to maintain <em>and</em> reusable. There are two modes of thinking that I like to employ:</p>

<h3 id="1.-think-purely-in-terms-of-business-logic-and-state">1. Think purely in terms of business logic and state</h3>

<p>Without even considering a UI, how would you describe the state of our permutation builder? How would you design an API to manipulate that state?</p>

<p>Consider <a href="https://facebook.github.io/flux/docs/overview.html#content">Flux</a>&#39;s idea of a store:</p>

<blockquote>
<p>Stores contain the application state and logic. Their role is somewhat similar to a model in a traditional MVC, but they manage the state of many objects â€” they do not represent a single record of data like ORM models do. Nor are they the same as Backbone&#39;s collections. More than simply managing a collection of ORM-style objects, stores manage the application state for a particular domain within the application.</p>
</blockquote>

<p>In an Angular app, we can implement something similar with a service, isolating the business logic and state for our permutation builder. This gives us a number of advantages:</p>

<ul>
<li>It&#39;s easier to test,</li>
<li>It becomes easier to reuse and extend, and</li>
<li>We avoid controller bloat, by properly isolating our concerns.</li>
</ul>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/service/permutation-builder-service.coffee">permutation-builder-service.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name PermutationBuilderService</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">A base class that can be extended for use with different permutable resources.</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">factory</span> <span class="s">&#39;PermutationBuilderService&#39;</span><span class="p">,</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">  permutationFactory</span>
</span><span class='line'><span class="nf">) -&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="nx">PermutationBuilderService</span>
</span><span class='line'>    <span class="nv">constructor: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">@initialize</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name initialize</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Method used to reset service to an empty state.</span>
</span><span class='line'><span class="cm">    Override this method to define attributes for a permutable resource.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">initialize: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="c1"># Regular attributes that get added to each permutation</span>
</span><span class='line'>      <span class="vi">@attributes = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Permutable attributes</span>
</span><span class='line'>      <span class="vi">@permutable_attributes = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Collection of permutations</span>
</span><span class='line'>      <span class="vi">@permutations = </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name addAttribute</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Adds a permutable attribute</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @param {String} key - Name of attribute</span>
</span><span class='line'><span class="cm">    @param {String|Number|Object|Array} value - Can be of any type</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Boolean} Whether attribute was added successfully or not.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">addAttribute: </span><span class="nf">(key, value) -&gt;</span>
</span><span class='line'>      <span class="nv">bucket = </span><span class="nx">@permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">throw</span> <span class="nb">Error</span> <span class="s">&quot;Invalid key: &#39;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s">&#39;&quot;</span> <span class="k">unless</span> <span class="nx">bucket</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">contains</span> <span class="nx">bucket</span><span class="p">,</span> <span class="nx">value</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&quot;&#39;</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">&#39; already entered.&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Add the value to permute against</span>
</span><span class='line'>      <span class="nx">bucket</span><span class="p">.</span><span class="nx">push</span> <span class="nx">value</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># And generate the permutations</span>
</span><span class='line'>      <span class="nx">@buildPermutations</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="kc">true</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name buildPermutations</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Builds permutations of the resource.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Array} Collection of permutations</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">buildPermutations: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="c1"># Empty our collection of permutations from previous runs</span>
</span><span class='line'>      <span class="vi">@permutations.length = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">permutationFactory</span><span class="p">.</span><span class="nx">permute</span> <span class="nx">@permutable_attributes</span><span class="p">,</span> <span class="nf">(permutation) =&gt;</span>
</span><span class='line'>        <span class="c1"># Extend common attributes onto each permutation</span>
</span><span class='line'>        <span class="nv">resource = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">permutation</span><span class="p">,</span> <span class="nx">@attributes</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">@permutations</span><span class="p">.</span><span class="nx">push</span> <span class="nx">resource</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">@permutations</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name createPermutations</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Abstract method. Override to define how a permutable resource gets persisted.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">createPermutations: </span><span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name removeAttribute</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Removes a permutable attribute by index</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @param {String} key - Attribute name</span>
</span><span class='line'><span class="cm">    @param {Integer} index - Index of value in the permutable attribute array.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Boolean} - true if item successfully removed</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">removeAttribute: </span><span class="nf">(key, index) -&gt;</span>
</span><span class='line'>      <span class="nv">bucket = </span><span class="nx">@permutable_attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">throw</span> <span class="nb">Error</span> <span class="s">&quot;Invalid key: &#39;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s">&#39;&quot;</span> <span class="k">unless</span> <span class="nx">bucket</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">removed = </span><span class="nx">bucket</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">@buildPermutations</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">removed</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>

<h3 id="2.-think-of-your-ui-in-terms-of-a-tree-of-components">2. Think of your UI in terms of a tree of components</h3>

<p>Look at your design. Look at your markup. Do you see any patterns? These parts of our UI are ripe for refactoring into directives.</p>

<p>Imagine being able to compose our view as such:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">kc-permutation-builder</span>(
</span><span class='line'>  <span class="na">service =</span> <span class="s">&quot;PermutationBuilderService&quot;</span>
</span><span class='line'>)
</span><span class='line'>  <span class="nc">.main</span>
</span><span class='line'>    <span class="nt">kc-permutable-input</span>(
</span><span class='line'>      <span class="na">name =</span> <span class="s">&quot;name&quot;</span>
</span><span class='line'>      <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>      <span class="na">required</span>
</span><span class='line'>    ) Name
</span><span class='line'>
</span><span class='line'>    <span class="nt">kc-permutable-input</span>(
</span><span class='line'>      <span class="na">name =</span> <span class="s">&quot;description&quot;</span>
</span><span class='line'>      <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>    ) Description
</span><span class='line'>
</span><span class='line'>  <span class="nc">.sidebar</span>
</span><span class='line'>    <span class="nt">kc-permutable-attribute</span>(
</span><span class='line'>      <span class="na">name =</span> <span class="s">&quot;name&quot;</span>
</span><span class='line'>    ) Name
</span><span class='line'>
</span><span class='line'>    <span class="nt">kc-permutable-attribute</span>(
</span><span class='line'>      <span class="na">name =</span> <span class="s">&quot;description&quot;</span>
</span><span class='line'>    ) Description
</span><span class='line'>
</span><span class='line'>    <span class="nt">button</span>(
</span><span class='line'>      <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>      <span class="na">ng-click =</span> <span class="s">&quot;submit()&quot;</span>
</span><span class='line'>    ) Create Permutations
</span></code></pre></td></tr></table></div></figure>

<p>That&#39;s a lot more succinct, expressive, and reusable.</p>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/directive/permutation-builder-directive.coffee">permutation-builder-directive.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name kcPermutationBuilder</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">This serves as a way to bind an instance of a PermutationBuilderService and</span>
</span><span class='line'><span class="cm">expose its API to a group of `kcPermutableInput` directives.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">Even though it has an isolate scope, it doesn&#39;t have any template, so it doesn&#39;t</span>
</span><span class='line'><span class="cm">introduce an isolate scope in the template in which its used.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">@param {PermutationBuilderService} service - Or a subclass thereof</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;kcPermutationBuilder&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">restrict: </span><span class="s">&#39;E&#39;</span>
</span><span class='line'>  <span class="nv">controller: </span><span class="s">&#39;KcPermutationBuilderController&#39;</span>
</span><span class='line'>  <span class="nv">scope:</span>
</span><span class='line'>    <span class="nv">service: </span><span class="s">&#39;=&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;KcPermutationBuilderController&#39;</span><span class="p">,</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">  $scope</span>
</span><span class='line'><span class="nf">) -&gt;</span>
</span><span class='line'>  <span class="vi">@permutable_attributes = </span><span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">permutable_attributes</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@addAttribute =</span>
</span><span class='line'>    <span class="nx">angular</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">addAttribute</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@removeAttribute =</span>
</span><span class='line'>    <span class="nx">angular</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">removeAttribute</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/directive/permutable-input-directive.coffee">permutable-input-directive.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name kcPermutableInput</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">Encapsulates templating and view logic for a permutable input, which is its</span>
</span><span class='line'><span class="cm">own mini form. Makes for a flexible component that can be used to compose the</span>
</span><span class='line'><span class="cm">view for any type of permutable resource.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">@param {String} name - Permutable attribute key</span>
</span><span class='line'>
</span><span class='line'><span class="cm">@example</span>
</span><span class='line'><span class="cm">`kc-permutable-input(name=&quot;title&quot;, type=&quot;text&quot;, required) Label`</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;kcPermutableInput&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">require: </span><span class="s">&#39;^kcPermutationBuilder&#39;</span>
</span><span class='line'>  <span class="nv">restrict: </span><span class="s">&#39;E&#39;</span>
</span><span class='line'>  <span class="nv">templateUrl: </span><span class="s">&#39;/permutation/_permutable-input.html&#39;</span>
</span><span class='line'>  <span class="nv">transclude: </span><span class="kc">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">scope:</span>
</span><span class='line'>    <span class="nv">name: </span><span class="s">&#39;@name&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">link: </span><span class="nf">(scope, element, attrs, kcPermutationBuilder) -&gt;</span>
</span><span class='line'>    <span class="c1"># Ensure input IDs are unique</span>
</span><span class='line'>    <span class="nv">scope.input_id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span> <span class="s">&#39;permutatable_input_&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.state =</span>
</span><span class='line'>      <span class="nv">value: </span><span class="s">&#39;&#39;</span>
</span><span class='line'>      <span class="nv">is_required: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">required</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name isDisabled</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    We don&#39;t want the submit button to be enabled if input is empty.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Boolean}</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.isDisabled = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">scope</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name isRequired</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    An input is no longer required if at least 1 value has already been entered.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Boolean}</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.isRequired = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">required</span><span class="o">?</span> <span class="o">and</span>
</span><span class='line'>        <span class="nx">kcPermutationBuilder</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">scope</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name submit</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Adds attribute and clears the input.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.submit = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">is_added = </span><span class="nx">kcPermutationBuilder</span><span class="p">.</span><span class="nx">addAttribute</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">scope</span><span class="p">.</span><span class="nx">name</span>
</span><span class='line'>        <span class="nx">scope</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="nx">is_added</span>
</span><span class='line'>        <span class="nv">scope.state.value = </span><span class="s">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/_permutable-input.jade">_permutable-input.jade</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">form</span><span class="nc">.form-group</span>(
</span><span class='line'>  <span class="na">ng-submit =</span> <span class="s">&quot;submit()&quot;</span>
</span><span class='line'>  <span class="na">name =</span> <span class="s">&quot;form&quot;</span>
</span><span class='line'>  <span class="na">ng-class =</span> <span class="s">&quot;{ &#39;has-error&#39;: form.$invalid &amp;&amp; form.value.$touched }&quot;</span>
</span><span class='line'>)
</span><span class='line'>  <span class="nt">label</span><span class="nc">.control-label</span>(
</span><span class='line'>    <span class="na">for =</span> <span class="s">&quot;{{input_id}}&quot;</span>
</span><span class='line'>  )
</span><span class='line'>    <span class="nt">span</span>(<span class="na">ng-transclude</span>)
</span><span class='line'>    <span class="nt">span</span>(<span class="na">ng-if=</span><span class="s">&quot;state.is_required&quot;</span>) *
</span><span class='line'>
</span><span class='line'>  <span class="nc">.input-group</span>
</span><span class='line'>    <span class="nt">input</span><span class="nc">.form-control</span>(
</span><span class='line'>      <span class="na">id =</span> <span class="s">&quot;{{input_id}}&quot;</span>
</span><span class='line'>      <span class="na">name =</span> <span class="s">&quot;value&quot;</span>
</span><span class='line'>      <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>      <span class="na">ng-model =</span> <span class="s">&quot;state.value&quot;</span>
</span><span class='line'>      <span class="na">ng-required =</span> <span class="s">&quot;isRequired()&quot;</span>
</span><span class='line'>    )
</span><span class='line'>
</span><span class='line'>    <span class="nc">.input-group-btn</span>
</span><span class='line'>      <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>        <span class="na">type =</span> <span class="s">&quot;submit&quot;</span>
</span><span class='line'>        <span class="na">ng-disabled =</span> <span class="s">&quot;isDisabled()&quot;</span>
</span><span class='line'>      ) Add
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/directive/permutable-attribute-directive.coffee">permutable-attribute-directive.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name kcPermutableAttribute</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">Displays the values entered for a permutable attribute.</span>
</span><span class='line'><span class="cm">Allows user to remove a value.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">@param {String} name - Permutable attribute key</span>
</span><span class='line'>
</span><span class='line'><span class="cm">@example</span>
</span><span class='line'><span class="cm">kc-permutable-attribute(</span>
</span><span class='line'><span class="cm">  name=&quot;description&quot;</span>
</span><span class='line'><span class="cm">) Description</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.permutation&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;kcPermutableAttribute&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">require: </span><span class="s">&#39;^kcPermutationBuilder&#39;</span>
</span><span class='line'>  <span class="nv">restrict: </span><span class="s">&#39;E&#39;</span>
</span><span class='line'>  <span class="nv">templateUrl: </span><span class="s">&#39;/permutation/_permutable-attribute.html&#39;</span>
</span><span class='line'>  <span class="nv">transclude: </span><span class="kc">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">scope:</span>
</span><span class='line'>    <span class="nv">name: </span><span class="s">&#39;@name&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">link: </span><span class="nf">(scope, element, attrs, kcPermutationBuilder) -&gt;</span>
</span><span class='line'>    <span class="nv">scope.permutable_attribute =</span>
</span><span class='line'>      <span class="nx">kcPermutationBuilder</span><span class="p">.</span><span class="nx">permutable_attributes</span><span class="p">[</span><span class="nx">scope</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name removeAttribute</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Calls on service to remove attribute.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @param {Integer} index - Value&#39;s index in the permutable attribute array.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope.removeAttribute = </span><span class="nf">(index) -&gt;</span>
</span><span class='line'>      <span class="nx">kcPermutationBuilder</span><span class="p">.</span><span class="nx">removeAttribute</span> <span class="nx">scope</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">index</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/permutation/_permutable-attribute.jade">_permutable-attribute.jade</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nc">.panel.panel-default</span>
</span><span class='line'>  <span class="nc">.panel-heading</span>
</span><span class='line'>    <span class="nt">strong</span>(<span class="na">ng-transclude</span>)
</span><span class='line'>    <span class="nt">strong</span> &amp;nbsp;({{permutable_attribute.length}})
</span><span class='line'>
</span><span class='line'>  <span class="nt">ul</span><span class="nc">.list-group</span>
</span><span class='line'>    <span class="nt">li</span><span class="nc">.list-group-item</span>(
</span><span class='line'>      <span class="na">ng-repeat =</span> <span class="s">&quot;attribute in permutable_attribute&quot;</span>
</span><span class='line'>    )
</span><span class='line'>      <span class="nt">span</span> {{attribute}}
</span><span class='line'>      <span class="nt">button</span><span class="nc">.btn.close</span>(
</span><span class='line'>        <span class="na">ng-click =</span> <span class="s">&quot;removeAttribute($index)&quot;</span>
</span><span class='line'>      ) &amp;times;
</span></code></pre></td></tr></table></div></figure>

<h2 id="the-new-and-improved-widget-builder">The New and Improved Widget Builder</h2>

<p>Now with the abstracted modules ready for use, look at how much leaner all of our widget-specific code is.</p>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/widget/service/widget-builder-service.coffee">widget-builder-service.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name WidgetBuilderService</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">Extends PermutationBuilderService for use with widgets.</span>
</span><span class='line'><span class="cm">Drives the business logic of the widget builder UI flow.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">NOTE: injection returns an instance, not the constructor (see end of file).</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.widget&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">factory</span> <span class="s">&#39;WidgetBuilderService&#39;</span><span class="p">,</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">  PermutationBuilderService</span>
</span><span class='line'><span class="nf">  widgetFactory</span>
</span><span class='line'><span class="nf">  widgetStore</span>
</span><span class='line'><span class="nf">  $q</span>
</span><span class='line'><span class="nf">) -&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="nx">WidgetBuilderService</span> <span class="k">extends</span> <span class="nx">PermutationBuilderService</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name initialize</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Defines permutable attributes for widgets.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">initialize: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">super</span>
</span><span class='line'>
</span><span class='line'>      <span class="vi">@permutable_attributes =</span>
</span><span class='line'>        <span class="nv">name: </span><span class="p">[]</span>
</span><span class='line'>        <span class="nv">description: </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name buildPermutations</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Here, we extend the base method to ensure that we only build valid widgets.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">buildPermutations: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">super</span>
</span><span class='line'>
</span><span class='line'>      <span class="vi">@permutations = </span><span class="nx">_</span><span class="p">.</span><span class="nx">filter</span> <span class="nx">@permutations</span><span class="p">,</span> <span class="nx">widgetFactory</span><span class="p">.</span><span class="nx">validate</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">###</span>
</span><span class='line'><span class="cm">    @name createPermutations</span>
</span><span class='line'><span class="cm">    @description</span>
</span><span class='line'><span class="cm">    Specifies how a permutation gets persisted.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    @returns {Promise} - Fulfilled with the newly created permutations.</span>
</span><span class='line'><span class="cm">    ###</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">createPermutations: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="c1"># Grab the permutations before we empty them</span>
</span><span class='line'>      <span class="nv">permutations = </span><span class="nx">@permutations</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Implement your AJAX call here</span>
</span><span class='line'>      <span class="nx">widgetStore</span><span class="p">.</span><span class="nx">addWidgets</span> <span class="nx">permutations</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Reset our service</span>
</span><span class='line'>      <span class="nx">@initialize</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">when</span> <span class="nx">permutations</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="k">new</span> <span class="nx">WidgetBuilderService</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/widget/controller/widget-builder-controller.coffee">widget-builder-controller.coffee</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="cm">###</span>
</span><span class='line'><span class="cm">@name WidgetBuilderController</span>
</span><span class='line'><span class="cm">@description</span>
</span><span class='line'><span class="cm">Our controller and its template become a very thin layer that</span>
</span><span class='line'><span class="cm">glue the pieces together.</span>
</span><span class='line'><span class="cm">###</span>
</span><span class='line'>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app.widget&#39;</span>
</span><span class='line'><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;WidgetBuilderController&#39;</span><span class="p">,</span> <span class="nf">(</span>
</span><span class='line'><span class="nf">  $scope</span>
</span><span class='line'><span class="nf">  $state</span>
</span><span class='line'><span class="nf">  WidgetBuilderService</span>
</span><span class='line'><span class="nf">) -&gt;</span>
</span><span class='line'>  <span class="nv">$scope.WidgetBuilderService = </span><span class="nx">WidgetBuilderService</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">###</span>
</span><span class='line'><span class="cm">  @name submit</span>
</span><span class='line'><span class="cm">  @description</span>
</span><span class='line'><span class="cm">  Calls on the service to create permutations, then redirects to home page.</span>
</span><span class='line'><span class="cm">  ###</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.submit = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">WidgetBuilderService</span><span class="p">.</span><span class="nx">createPermutations</span><span class="p">().</span><span class="nx">then</span> <span class="nf">(widgets) -&gt;</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;look at all these widgets we built!&#39;</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">table</span> <span class="nx">widgets</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span> <span class="s">&#39;home&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="https://github.com/kvcrawford/ng-permutation-builder/blob/master/src/widget/widget-builder.jade">widget-builder.jade</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nc">.container-fluid</span>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nc">.col-md-12</span>
</span><span class='line'>      <span class="nt">p</span><span class="nc">.lead</span> Let&#39;s build some widgets.
</span><span class='line'>
</span><span class='line'>  <span class="nt">kc-permutation-builder</span>(
</span><span class='line'>    <span class="na">service =</span> <span class="s">&quot;WidgetBuilderService&quot;</span>
</span><span class='line'>  )
</span><span class='line'>    <span class="nc">.row</span>
</span><span class='line'>      <span class="nc">.col-lg-6.col-md-8.col-sm-6</span>
</span><span class='line'>          <span class="nt">kc-permutable-input</span>(
</span><span class='line'>            <span class="na">name =</span> <span class="s">&quot;name&quot;</span>
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>            <span class="na">required</span>
</span><span class='line'>          ) Name
</span><span class='line'>
</span><span class='line'>          <span class="nt">kc-permutable-input</span>(
</span><span class='line'>            <span class="na">name =</span> <span class="s">&quot;description&quot;</span>
</span><span class='line'>            <span class="na">type =</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>          ) Description
</span><span class='line'>
</span><span class='line'>      <span class="nc">.col-lg-4.col-md-4.col-sm-6</span>
</span><span class='line'>        <span class="nc">.panel.panel-default</span>
</span><span class='line'>          <span class="nc">.panel-heading</span>
</span><span class='line'>            <span class="nt">h4</span><span class="nc">.panel-title</span> {{WidgetBuilderService.permutations.length}} Widgets Built
</span><span class='line'>
</span><span class='line'>          <span class="nc">.panel-body</span>
</span><span class='line'>            <span class="nt">kc-permutable-attribute</span>(
</span><span class='line'>              <span class="na">name =</span> <span class="s">&quot;name&quot;</span>
</span><span class='line'>            ) Name
</span><span class='line'>
</span><span class='line'>            <span class="nt">kc-permutable-attribute</span>(
</span><span class='line'>              <span class="na">name =</span> <span class="s">&quot;description&quot;</span>
</span><span class='line'>            ) Description
</span><span class='line'>
</span><span class='line'>          <span class="nc">.panel-footer</span>
</span><span class='line'>            <span class="nc">.btn-group</span>
</span><span class='line'>              <span class="nt">button</span><span class="nc">.btn.btn-primary</span>(
</span><span class='line'>                <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>                <span class="na">ng-click =</span> <span class="s">&quot;submit()&quot;</span>
</span><span class='line'>                <span class="na">ng-disabled =</span> <span class="s">&quot;WidgetBuilderService.permutations.length === 0&quot;</span>
</span><span class='line'>              ) Submit
</span><span class='line'>
</span><span class='line'>              <span class="nt">button</span><span class="nc">.btn.btn-default</span>(
</span><span class='line'>                <span class="na">type =</span> <span class="s">&quot;button&quot;</span>
</span><span class='line'>                <span class="na">ng-click =</span> <span class="s">&quot;WidgetBuilderService.initialize()&quot;</span>
</span><span class='line'>                <span class="na">ng-disabled =</span> <span class="s">&quot;WidgetBuilderService.permutations.length === 0&quot;</span>
</span><span class='line'>              ) Reset
</span></code></pre></td></tr></table></div></figure>

<h2 id="going-forward">Going Forward</h2>

<p>Now, it&#39;s trivial to implement a permutation builder for <em>Gadgets</em>. Or, say we wanted to support permutations of images? The surface area for changes needed is minimal: we just need a new <code>kcPermutableImage</code> directive, and the rest would work pretty much as-is.</p>

<p>Neat, huh?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Kevin Crawford</span></span>

      








  


<time datetime="2015-06-20T13:01:00-07:00" pubdate data-updated="true">Jun 20<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/angular/'>angular</a>, <a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/frontend/'>frontend</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/02/09/introducing-ng-coffeeplate/" title="Previous Post: Introducing: ng-coffeeplate">&laquo; Introducing: ng-coffeeplate</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/06/20/architecting-maintainable-reusable-uis-in-angular/">Architecting Maintainable, Reusable UIs in Angular: A Case Study</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/09/introducing-ng-coffeeplate/">Introducing: Ng-coffeeplate</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/20/configuring-a-production-node-js-and-mongodb-environment-in-ubuntu-on-an-amazon-ec2-instance/">Configuring a Production Node.js and MongoDB Environment in Ubuntu on an Amazon EC2 Instance</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/30/cloning-an-existing-installation-of-octopress/">Cloning an Existing Installation of Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/20/hello-world/">Hello, World</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/kvcrawford">@kvcrawford</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kvcrawford',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:kvcrawford">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "kvcrawford"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/100412605131936780000?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Kevin Crawford -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kvcrawford';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kvcrawford.github.io/blog/2015/06/20/architecting-maintainable-reusable-uis-in-angular/';
        var disqus_url = 'http://kvcrawford.github.io/blog/2015/06/20/architecting-maintainable-reusable-uis-in-angular/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
